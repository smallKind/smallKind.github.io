---
layout: post
title: MySQL性能优化
date: 2017-05-04 22:06:01 +8000
category: MySQL
tags: 性能优化
---

* content
{:toc}

对于关于性能的问题，每个人基于自己的理解可能会有不同的回答，比如“QPS”、"TPS"、“CPU利用率”、“可扩展性”等等。但我觉得性能在《高性能的MySQL》这本书定义的透彻。

>> 完成某件任务所需要的时间，换句话说，性能即响应时间

在互联网时代，从用户的角度来理解，打开一个网页，响应时间的快慢就决定网站性能的好坏，所以优化性能其实就是优化响应时间。不管什么架构，数据库作为最重要的部分，往往也是最容易出现瓶颈的环节。后面将从实际项目中遇到的性能问题来怎么进行表设计，SQL，索引的性能优化。

### 表设计

#### 选择优化的数据类型

1. 更小的通常更好。一般情况下，应该尽量使用可以正确存储数据的最小数据类型。更小的数据类型通常更快，因为它们占用更少的磁盘、内存和CPU缓存，并且处理时需要的CPU周期也更少。
2. 简单就好。简单的数据类型的操作通常需要更少的CPU周期。
3. 尽量避免NULL。MySQL难以优化引用了可空列的查询，空列会使索引，索引统计和值更加复杂，可空列需要更多的存储空间。一般来说，设置默认值（DEFAULT)是个比较好的习惯。

引用《高性能的MySQL》。

#### 冗余

在实际项目中，有大量相互关联的表，一部分业务是需要关联查询。但关联查询的速度比单表查询的速度慢，有时提升性能最好的方法就是在同一张表中保存衍生的冗余数据，使关联查询变成单表查询。

### SQL

[MYSQL性能优化的最佳20+条经验](http://coolshell.cn/articles/1846.html)

### 索引

#### 设计索引的原则

1. 搜索的索引列，不一定是所要选择的列。最适合索引的列是出现在WHERE、GROUP BY、ORDER BY子句中的列，或者连接子句中的列。
2. 使用唯一索引。考虑到某列中值的分布。索引的列的基数越大，索引的效果越好。例如：用户的唯一识别码，对应唯一的用户，很容易根据索引找到用户。而用户的性别，只有男和女，不管搜索那一列都会搜出大约一半的记录。唯一索引还能保证此列的值都是唯一。
3. 使用短索引。如果是对字符串进行索引，只要有可能，就应该指定一个前缀长度。比如，这列中的字符串平均长度在200左右，但在前10个或者前20个，大多数值是唯一的，那么就不要对全部值进行索引。对前10个或者前20个字符串进行索引能大大减少索引空间，也可能会使整个查询变快。较小的索引涉及到的ci'pan磁盘I/O更少，较短的索引比较起来更快。
4. 利用最左前缀。
5. 不要过度使用索引。索引也不是越多越好，每一个索引都要占用额外的磁盘空间，并降低写的操作性能。在修改表的内容时，索引必须进行更新，有时还需要重构，因此，索引越多，花费的时间越长。

